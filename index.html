<!DOCTYPE html>
<html lang="pt-br">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Login</title>
        <link rel="stylesheet" href="./Css/telaLogin-Cadastro.css">
        <link rel="manifest" href="manifest.json">
        <meta name="description" content="Tela de Login.">
        <link rel="apple-touch-icon" sizes="180x180" href="icons/favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon/favicon-16x16.png">
        <meta name="theme-color" content="#4758F0"/>
    </head>


    <body>
        <meta name="theme-color" content="#F5F5F5"/>
        <header>
            <h1>AlagaMaps</h1>
        </header>

        <!--CAIXA DE FORMULÁRIO-->
        <main class="container">
            <h2>Login</h2>
            <br>
            <form action="">

                <!--CAMPO DE LOGIN - EMAIL-->
                <div class="campoInput">
                    <input type="email" name="email" id="emailLogin" placeholder="Digite o seu email">
                    <div class="underline"></div>
                </div>

                <br>

                <!--CAMPO DE LOGIN - SENHA-->
                <br>
                <div class="campoInput">
                    <input type="password" name="senha" id="senhaLogin" placeholder="Digite sua senha"> 
                    <div class="underline"></div>
                </div>

                <div class="campoLink">
                    <ul>
                        <li><a href="./telaPrincipal.html">Entrar sem Login</a></li>
                        <li><a href="./telaRecuperarSenha.html">Esqueceu sua senha?</a></li>
                    </ul>
                </div>

                <input type="submit" value="Login" onclick="Login()">

                <div class="texto">
                    <h5>Não tem uma conta?</h5>
                </div>
                

                <div class="cadastre-se">
                    <button>
                        <a href="./telaCadastro.html">Cadastre-se</a>
                    </button>
                </div>
                
    
            </form>
        </main>
        <script>
            async function paraPrincipal() {
                const delay = (ms) => new Promise((res) => setTimeout(res, ms));
                await delay(1500)
                location.href = "./telaPrincipal.html";
            }
            async function Login(){
                try{
                    var emL = document.getElementById('emailLogin').value;
                    var snhL = document.getElementById('senhaLogin').value;
                    if(emL == '' || snhL == ''){
                        alert("Nenhum campo pode ser nulo")
                    }
                    else{
                        let headerInformacoes = {
                            "Accept": "*/*",
                            "Content-Type": "application/json"
                        }
                        
                        let bodyInformacoes = JSON.stringify({
                                "email":emL,
                                "pwd":snhL
                        });
                        
                        let response = await fetch("https://servidor-alagamaps.vercel.app/api/usuarios/checar", { 
                            method: "POST",
                            body: bodyInformacoes,
                            headers: headerInformacoes
                        });
                        
                        let data = await response.json();
                        if (typeof(data.id) == 'number'){
                            alert("Bem vindo(a) " + data.nome)
                            await paraPrincipal()
                        }

                }}
                    catch(e){
                        console.log(e) 
                        alert("Parece que houve um erro ao tentar fazer o login, tente denovo. Caso o problema persistir, entre em contato conosco. " + e)}

                }
        </script>
        <script>
            let newWorker;

            if ('serviceWorker' in navigator) {
              navigator.serviceWorker.register('/swbuilder.js').then(reg => {
                reg.addEventListener('updatefound', () => {
                  // A wild service worker has appeared in reg.installing!
                  newWorker = reg.installing;
                  newWorker.addEventListener('statechange', () => {
                    // Has network.state changed?

                  });
                });
              });
              let refreshing;
              navigator.serviceWorker.addEventListener('controllerchange', function () {
                if (refreshing) return;
                window.location.reload();
                refreshing = true;
              });
            }
          </script>
    </body>

</html>